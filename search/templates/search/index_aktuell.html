{% load staticfiles %}
<html lang="en">

<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://fonts.googleapis.com/css?family=Montserrat+Subrayada" rel="stylesheet">


    <title>Easy Living</title>

    <script src="{% static 'js/filter.js' %}" type="text/javascript"></script>

    <!-- Bootstrap Core CSS -->
    <link href="{% static 'css/bootstrap.min.css' %}" rel="stylesheet">

    <!-- Theme CSS -->
    <link href="{% static 'css/clean-blog.min.css' %}" rel="stylesheet">

    <!-- Custom Fonts -->
    <script src="{% static 'js/jquery.js' %}" type="text/javascript"></script>

    <link href="{% static 'css/font-awesome.min.css' %}" rel="stylesheet" type="text/css">
    <link href='https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/css'>
    <link href="https://gitcdn.github.io/bootstrap-toggle/2.2.2/css/bootstrap-toggle.min.css" rel="stylesheet">
    <script src="https://gitcdn.github.io/bootstrap-toggle/2.2.2/js/bootstrap-toggle.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <link rel="stylesheet" href="{% static 'css/bootstrap-slider.min.css' %}">
    <script src="{% static 'css/bootstrap-slider.min.js' %}" type="text/javascript"></script>

    <!-- Leaflet -->
    <link rel="stylesheet" href="{% static 'leaflet/leaflet.css' %} "/>
    <script src="{% static 'leaflet/leaflet-src.js' %}" type="text/javascript"></script>
    <script>
        var map;
        var csrftoken;
        $(document).ready(
            function init_map() {
                csrftoken = jQuery("[name=csrfmiddlewaretoken]").val();
                map = L.map('mapid').setView([50.938, 6.95], 10);
                L.tileLayer(
                    'https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token={accessToken}',
                    {
                        attribution: 'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, <a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery © <a href="http://mapbox.com">Mapbox</a>',
                        maxZoom: 18,
                        //id: 'mapbox.mapbox-streets-v7',
                        //id: 'mapbox.mapbox-terrain-v2',
                        //id: 'mapbox.mapbox-traffic-v1',
                        id: 'mapbox.satellite',
                        accessToken: 'pk.eyJ1IjoicnN0b2RkZW4iLCJhIjoiY2ozdmt0ZDN3MDAydDR1cG1ybXduYjFsZiJ9.1SgNsXjR5DBwU6uEWTZF1A'
                    }
                ).addTo(map);
                //var marker = L.marker([50.938, 6.95]).addTo(map);
                //var poly = L.polygon([[[50.9690877834368,7.00925780777239],[50.9682048669575,7.00911972076204],[50.9673558646356,7.00871076633736],[50.9665734058739,7.00804666038754],[50.9658875641941,7.00715292413179],[50.9653247009086,7.00606390335322],[50.9649064513392,7.00482144850962],[50.9646488926526,7.00347330644385],[50.9645619254045,7.00207128549944],[50.9646488926526,7.00066926455503],[50.9649064513392,6.99932112248925],[50.9653247009086,6.99807866764565],[50.9658875641941,6.99698964686708],[50.9665734058739,6.99609591061134],[50.9673558646356,6.99543180466152],[50.9682048669575,6.99502285023683],[50.9690877834368,6.99488476322648],[50.9699706831334,6.99502285023683],[50.9708196376624,6.99543180466152],[50.9716020248969,6.99609591061134],[50.9722877822047,6.99698964686708],[50.9728505611183,6.99807866764565],[50.9732687391606,6.99932112248925],[50.9735262500543,7.00066926455503],[50.9736132005197,7.00207128549944],[50.9735262500543,7.00347330644385],[50.9732687391606,7.00482144850962],[50.9728505611183,7.00606390335322],[50.9722877822047,7.00715292413179],[50.9716020248969,7.00804666038754],[50.9708196376624,7.00871076633736],[50.9699706831334,7.00911972076204],[50.9690877834368,7.00925780777239]],[[50.9690877834368,7.02363085231831],[50.9655736869431,7.02289622789339],[50.9622988310278,7.02074241805917],[50.959486464264,7.0173162013965],[50.9573283439166,7.01285106890887],[50.9559716414413,7.00765131199632],[50.9555088864332,7.00207128549944],[50.9559716414413,6.99649125900256],[50.9573283439166,6.99129150209],[50.959486464264,6.98682636960237],[50.9622988310278,6.98340015293971],[50.9655736869431,6.98124634310549],[50.9690877834368,6.98051171868057],[50.9726016140884,6.98124634310549],[50.9758757437098,6.98340015293971],[50.9786871183376,6.98682636960237],[50.9808442465492,6.99129150209],[50.9822002227305,6.99649125900256],[50.9826627118967,7.00207128549944],[50.9822002227305,7.00765131199632],[50.9808442465492,7.01285106890887],[50.9786871183376,7.0173162013965],[50.9758757437098,7.02074241805917],[50.9726016140884,7.02289622789339],[50.9690877834368,7.02363085231831]]]).addTo(map);
            }
        );
        /**
         * @global map
         */
        function getCityPoly (cityName) {
            $.ajax(
                './search/cityPolygon',
                {
                    cache: false,
                    dataType: "json",
                    data: {
                        csrfmiddlewaretoken: csrftoken,
                        city: cityName
                    },
                    method: 'POST',
                    success: function (data, textStatus, jqXHR) {
                        for (i = 0; i < data.length; i++) {
                            var latlngs = makePoints(data[i].way);
                            var polygon = L.polygon(latlngs, {color: 'red'}).addTo(map);
                            if (i == 0) {
                                map.fitBounds(polygon.getBounds());
                            }

                        }

                    },
                    error: function (jqXHR, textStatus, errorThrown) {
                        alert("Error: " + errorThrown
                            + "\nStatus: " + textStatus
                            + "\njqXHR: " + JSON.stringify(jqXHR)
                        );
                    },
                    complete: function (jqXHR, textStatus) {}
                }
            );
        }

        function getCityFilter (filter, osm_id) {
            $.ajax(
                './search/cityFilter',
                {
                    cache: false,
                    dataType: "json",
                    data: {
                        csrfmiddlewaretoken: csrftoken,
                        filter_value: filter,
                        city_osm_id: osm_id
                    },
                    method: 'POST',
                    success: function (data, textStatus, jqXHR) {
                        console.log(data.length);
                        if (data.length == 0) {
                            alert("Bitte mindestens einen und maximal 3 Filter auswählen! Es wurden keine Treffer gefunden.");
                        }
                        else {
                            for (i = 0; i < data.length; i++) {
                                var latlngs = makePoints(data[i].way);
                                var polygon = L.polygon(latlngs, {color: 'blue'}).addTo(map);
                            }
                        }
                    },
                    /*success: function (data, textStatus, jqXHR) {
                        console.log(data);
                        var latlongs = makePoints(data[0].way); // todo: funktioniert nicht für Ringe, da doppeltes Polygon, muss anders gesplittet werden
                        var polygon = L.polygon(latlongs, {color: 'red'}).addTo(map);
                        map.fitBounds(polygon.getBounds())
                    },*/
                    error: function (jqXHR, textStatus, errorThrown) {
                        alert("Error: " + errorThrown
                            + "\nStatus: " + textStatus
                            + "\njqXHR: " + JSON.stringify(jqXHR)
                        );
                    },
                    complete: function (jqXHR, textStatus) {}
                }
            );
        }

        /**
         * 51.0616154051779 6.77253026067161
         */
        function retPoint (pointStr, index, refToArray) {
            var temp = pointStr.split(" ", 2);
            refToArray[index] = [parseFloat(temp[0]), parseFloat(temp[1])];
        }

        /**
         * POLYGON((51.0616154051779 6.77253026067161,51.0616932038293 6.77256430682088,51.0622437751639 6.77280460615938,51.0633110812758 6.77339956037205))
         */
        function makePoints (polygonPointsStr) {
            var retVal = polygonPointsStr.substring(9, polygonPointsStr.length - 2).split(',');
            retVal.forEach(retPoint);
            return retVal;
        }
    </script>



</head>

<body>



    <div class="container-fluid">
        <div class="row">
            <!--Suchfeld-->
            <div class="col-md-2" style="margin-top:15px">
                <div class="search-field">
                    <form method="post" action="">{% csrf_token %}
                        <div class="row">
                            <div class="form-group">
                                <input type="text" style="width:240px" placeholder="Stadt, Stadteil oder PLZ" class="form-control" name="suchanfrage" id = "town" value=""/> <!-- Die folgende Zeile ermöglicht über das Attribut "name" den Zugriff auf den Inhalt des Textfeldes -->
                            </div>
                        </div>
                    </form>
                </div>
            </div>

            <!--Suchbutton-->
            <div class="col-md-2 button-left" style="margin-top:15px">
                <button id="searchbutton" type="submit" href="#canvas" name="submitsuche" class="btn btn-default" onclick="getCityPoly(getCityName())">Suchen</button>
            </div>

            <!--Stadbezirk/-teil Auswahl-->
            <!--<div class="col-md-2">
                <div class="list-group">
                    <a href="#" class="list-group-item list-group-item-action active " id="auswahl1">Auswahl 1</a>
                    <a href="#" class="list-group-item list-group-item-action">Auswahl 2</a>
                </div>
            </div>-->
            <div class="col-md-2" style="margin-top:15px">
                <div class="dropdown">
                    <button  class="btn btn-primary dropdown-toggle" type="button"  data-toggle="dropdown">Auswahl<span class="caret"></span></button>
                    <ul class="dropdown-menu">
                        <a href="#" class="list-group-item list-group-item-action">Stadbezirk/-teil 1</a>
                        <a href="#" class="list-group-item list-group-item-action">Stadbezirk/-teil 2</a>
                        <a href="#" class="list-group-item list-group-item-action">Stadbezirk/-teil 3</a>
                        <a href="#" class="list-group-item list-group-item-action">Stadbezirk/-teil 4</a>
                        <a href="#" class="list-group-item list-group-item-action">Stadbezirk/-teil 5</a>
                    </ul>
                </div>
            </div>

            <!--Logo-->
            <div class="col-md-6" style="margin-top: 2px">
                <img src="/static/css/Logo.png" class="img-responsive" align="right">
            </div>
        </div>

        <div class="row" style="padding:3px">
            <!--Filter: Transport-->
            <div class="col-md-2">
                <div class="dropdown">
                    <button  class="btn btn-primary dropdown-toggle" type="button"  data-toggle="dropdown">Transport<span class="caret"></span></button>
                    <ul class="dropdown-menu">
                        <li><a href="#" name="checks2[]" class="dropdownauswahl" data-value="1"><input type="radio" name="filter" class="sliderfilter" id="1" value="bus_stop"/>Bushaltestelle</a></li>
                        <li><a href="#" name="checks2[]" class="dropdownauswahl" data-value="2"><input type="radio" name="filter" class="sliderfilter" id="2" value="bus_station"/>Busbahnhof</a></li>
                        <li><a href="#" name="checks2[]" class="dropdownauswahl" data-value="3"><input type="radio" name="filter" class="sliderfilter" id="3" value="station"/>Bahnhof</a></li>
                        <li><a href="#" name="checks2[]" class="dropdownauswahl" data-value="4"><input type="radio" name="filter" class="sliderfilter" id="4" value="subway_entrance"/>U-Bahn</a></li>
                        <li><a href="#" name="checks2[]" class="dropdownauswahl" data-value="5"><input type="radio" name="filter" class="sliderfilter" id="5" value="railway"/>Straßenbahn</a></li>
                        <li><a href="#" name="checks2[]" class="dropdownauswahl" data-value="6"><input type="radio" name="filter" class="sliderfilter" id="6" value="aeroway"/>Flughafen</a></li>
                    </ul>
                </div>
            </div>

            <!--Filter: Freizeit-->
            <div class="col-md-2">
                <div class="dropdown">
                    <button  class="btn btn-primary dropdown-toggle" type="button"  data-toggle="dropdown">Freizeit<span class="caret"></span></button>
                    <ul class="dropdown-menu">
                        <li><a href="#" name="checks2[]" class="dropdownauswahl" data-value="1"><input type="radio" name="filter" class="sliderfilter" id="7" value="park"/>Park</a></li>
                        <li><a href="#" name="checks2[]" class="dropdownauswahl" data-value="1"><input type="radio" name="filter" class="sliderfilter" id="8" value="recreation_ground"/>Erholungsgebiet</a></li>
                        <li><a href="#" name="checks2[]" class="dropdownauswahl" data-value="1"><input type="radio" name="filter" class="sliderfilter" id="9" value="dog_park"/>Hundepark</a></li>
                        <li><a href="#" name="checks2[]" class="dropdownauswahl" data-value="1"><input type="radio" name="filter" class="sliderfilter" id="10" value="playground"/>Spielplatz</a></li>
                        <li><a href="#" name="checks2[]" class="dropdownauswahl" data-value="1"><input type="radio" name="filter" class="sliderfilter" id="11" value="fitness_centre"/>Fitnessstudio</a></li>
                        <li><a href="#" name="checks2[]" class="dropdownauswahl" data-value="1"><input type="radio" name="filter" class="sliderfilter" id="12" value="cinema"/>Kino</a></li>
                        <li><a href="#" name="checks2[]" class="dropdownauswahl" data-value="1"><input type="radio" name="filter" class="sliderfilter" id="13" value="theatre"/>Theater</a></li>
                        <li><a href="#" name="checks2[]" class="dropdownauswahl" data-value="1"><input type="radio" name="filter" class="sliderfilter" id="14" value="nightclub"/>Nachtclub</a></li>
                    </ul>
                </div>
            </div>

            <!--Filter: Bildung-->
            <div class="col-md-2">
                <div class="dropdown">
                    <button  class="btn btn-primary dropdown-toggle" type="button"  data-toggle="dropdown">Bildung<span class="caret"></span></button>
                    <ul class="dropdown-menu">
                        <li><a href="#" name="checks2[]" class="dropdownauswahl" data-value="1"><input type="radio" name="filter" class="sliderfilter" id="15" value="kindergarten"/>Kindergarten</a></li>
                        <li><a href="#" name="checks2[]" class="dropdownauswahl" data-value="1"><input type="radio" name="filter" class="sliderfilter" id="16" value="school"/>Schule</a></li>
                        <li><a href="#" name="checks2[]" class="dropdownauswahl" data-value="1"><input type="radio" name="filter" class="sliderfilter" id="17" value="college"/>Hochschule</a></li>
                        <li><a href="#" name="checks2[]" class="dropdownauswahl" data-value="1"><input type="radio" name="filter" class="sliderfilter" id="18" value="university"/>Universität</a></li>
                    </ul>
                </div>
            </div>

            <!--Umkreis Minimum-->
            <div class="col-md-1" style="margin-top:5px; text-align:right;">
                <div class="form-group">
                  <label class="umkreis" id ="inputmin" for="min">min</label>
                </div>
            </div>

            <!--Umkreif Minimum Textfeld-->
            <div class="col-md-1" style="margin-top:5px">
                <div class="forn-group">
                    <input type="text" class="form-control" style="width:170px" name="min_radius" id = "min" value=""/> <!-- Die folgende Zeile ermöglicht über das Attribut "name" den Zugriff auf den Inhalt des Textfeldes -->
                </div>
            </div>

            <!--Umkreis Maximum-->
            <div class="col-md-1" style="margin-top: 5px; text-align:right;">
                <div class="form-group">
                  <label class="umkreis" id ="inputmax" for="min">max</label>
                </div>
            </div>

            <!--Umkreis Maximum Textfeld-->
            <div class="col-md-1" style="margin-top: 5px">
                <div class="form-group">
                    <input type="text" class="form-control" style="width:170px" name="max_radius" id = "max" value=""/> <!-- Die folgende Zeile ermöglicht über das Attribut "name" den Zugriff auf den Inhalt des Textfeldes -->
                </div>
            </div>

            <!--Button um Filter zur Auswahl hinzuzufügen-->
            <div class="col-md-2" align="right">
                <button id="add-filter" type="button" style="width: 150px" name="add_filter" class="btn btn-default" onclick='addFilter()'>Hinzufügen</button>
            </div>
        </div>

        <div class="row" style="padding: 2px">
            <!--Filter: Gesundheit-->
            <div class="col-md-2">
                <div class="dropdown">
                    <button  class="btn btn-primary dropdown-toggle" type="button"  data-toggle="dropdown">Gesundheit<span class="caret"></span></button>
                    <ul class="dropdown-menu">
                        <li><a href="#" name="checks2[]" class="dropdownauswahl" data-value="1"><input type="radio" name="filter" class="sliderfilter" id="19" value="doctors"/>Artzpraxi</a></li>
                        <li><a href="#" name="checks2[]" class="dropdownauswahl" data-value="1"><input type="radio" name="filter" class="sliderfilter" id="20" value="clinic"/>Klinik</a></li>
                        <li><a href="#" name="checks2[]" class="dropdownauswahl" data-value="1"><input type="radio" name="filter" class="sliderfilter" id="21" value="dentist"/>Zahnarzt</a></li>
                        <li><a href="#" name="checks2[]" class="dropdownauswahl" data-value="1"><input type="radio" name="filter" class="sliderfilter" id="22" value="hospital"/>Krankenhaus</a></li>
                        <li><a href="#" name="checks2[]" class="dropdownauswahl" data-value="1"><input type="radio" name="filter" class="sliderfilter" id="23" value="social_facility"/>Soziale Einrichtung</a></li>
                        <li><a href="#" name="checks2[]" class="dropdownauswahl" data-value="1"><input type="radio" name="filter" class="sliderfilter" id="24" value="nursing_home"/>Pflegeheim</a></li>
                        <li><a href="#" name="checks2[]" class="dropdownauswahl" data-value="1"><input type="radio" name="filter" class="sliderfilter" id="25" value="veterinary"/>Tierarzt</a></li>
                    </ul>
                </div>
            </div>

            <!--Filter: Religiton-->
            <div class="col-md-2">
                <div class="dropdown">
                    <button  class="btn btn-primary dropdown-toggle" type="button"  data-toggle="dropdown">Religion<span class="caret"></span></button>
                    <ul class="dropdown-menu">
                        <li><a href="#" name="checks2[]" class="dropdownauswahl" data-value="1"><input type="radio" name="filter" class="sliderfilter" id="26" value="place_of_worship"/>Andachtsort</a></li>
                    </ul>
                </div>
            </div>

            <!--Filter: Geschäfte und Co.-->
            <div class="col-md-2">
                <div class="dropdown">
                    <button  class="btn btn-primary dropdown-toggle" type="button"  data-toggle="dropdown">Geschäfte & Co.<span class="caret"></span></button>
                    <ul class="dropdown-menu">
                        <li><a href="#" name="checks2[]" class="dropdownauswahl" data-value="1"><input type="radio" name="filter" class="sliderfilter" id="27" value="supermarket"/>Supermarkt</a></li>
                        <li><a href="#" name="checks2[]" class="dropdownauswahl" data-value="1"><input type="radio" name="filter" class="sliderfilter" id="28" value="chemist"/>Drogerie</a></li>
                        <li><a href="#" name="checks2[]" class="dropdownauswahl" data-value="1"><input type="radio" name="filter" class="sliderfilter" id="29" value="pharmacy"/>Apotheke</a></li>
                        <li><a href="#" name="checks2[]" class="dropdownauswahl" data-value="1"><input type="radio" name="filter" class="sliderfilter" id="30" value="mall"/>Einkaufszentrum</a></li>
                        <li><a href="#" name="checks2[]" class="dropdownauswahl" data-value="1"><input type="radio" name="filter" class="sliderfilter" id="31" value="bank"/>Bank</a></li>
                        <li><a href="#" name="checks2[]" class="dropdownauswahl" data-value="1"><input type="radio" name="filter" class="sliderfilter" id="32" value="atm"/>Geldautomat</a></li>
                        <li><a href="#" name="checks2[]" class="dropdownauswahl" data-value="1"><input type="radio" name="filter" class="sliderfilter" id="33" value="restaurant"/>Restaurant</a></li>
                    </ul>
                </div>
            </div>

            <!--Buttom um Filter anzuwenden-->
            <div class="col-md-6" align="right">
                <button id="use_filter" style="width: 300px" type="button"  name="use_filter" class="btn btn-default" onclick="getCityFilter(getFilterText(),getCityOsmId())">Alle Filter anwenden</button>
            </div>
        </div>

        <div class="row" style="padding:3px">
            <!--Ausgewählte Filter-->
            <div class="col-md-2" style="margin-top: 5px; text-align:right;">
                <div class="form-group">
                    <label class="marked_filter" id="input_marked_filter">Ausgewählte Filter</label>
                </div>
            </div>

            <!--Ausgewählte Filter Textfeld-->
            <div class="col-md-10" style="margin-top: 5px";>
                <div class="form-group">
                    <input type="text" class="form-control" style="width: 1150px" name="marked_filter" id = "markedFilter" value=""/> <!--Textfeld für ausgewählte Filter-->
                </div>
            </div>
        </div>
    </div>

    <div class="container-fluid" style="margin-top: 10px">
          <div class="col-xs-12">
		    <div id="mapid" class="mapcanvas"style="border:1px solid #000000; width:100%; height:80%;"></div> <!--style="border:1px solid #000000; width:640px; height:480px;"-->
          </div>
    </div>



    <!-- Footer -->
    <footer>
        <div class="container">
            <div class="col">
                <!--<div class="Logo" style="image: url({% static 'css/Logo_transparent.jpg' %})">-->
                    <!--<img src="Logo_transparent.png" class="img-responsive" alt="Logo">-->

                </div>
                <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                    </ul>
                    <p class="copyright text-muted">Copyright &copy; EasyLiving 2017</p>
                </div>
            </div>
        </div>

        <!-- Feld zur Zwischenspeicherung eingefügt -->
        <div>
            <input name="city_osm_id" id="city_osm_id" value="-62578"/>
        </div>
    </footer>




<script>
    //console.log(document.getElementById("city_osm_id"));




</script>
<button onclick="getCityPoly('Köln')">Get Köln Polygon</button>
<button onclick="getCityPoly('Düsseldorf')">Get Düsseldorf Polygon</button>
<button onclick="getCityPoly('Bielefeld')">Get Bielefeld Polygon</button>

</body>
</html>
